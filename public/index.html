<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Cat√°logo de Recorridos</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>‚ôû Cat√°logo de Recorridos Knight's Tour</h1>
  <button id="btnStart">‚ñ∂Ô∏è Iniciar b√∫squeda sin fin</button>
  <button id="btnStop" disabled>‚èπÔ∏è Detener</button>
  <button id="btnSend" disabled>üíæ Enviar cat√°logo al servidor</button>
  <pre id="progressInfo">Esperando inicio...</pre>

  <script>
    let running = false;
    let catalog = [];
    const btnStart = document.getElementById("btnStart");
    const btnStop = document.getElementById("btnStop");
    const btnSend = document.getElementById("btnSend");
    const progressInfo = document.getElementById("progressInfo");

    btnStart.onclick = () => {
      running = true;
      catalog = [];
      btnStart.disabled = true;
      btnStop.disabled = false;
      btnSend.disabled = true;
      progressInfo.textContent = "üîÑ Iniciando b√∫squeda...";
      startSearching();
    };

    btnStop.onclick = () => {
      running = false;
      btnStart.disabled = false;
      btnStop.disabled = true;
      btnSend.disabled = false;
      progressInfo.textContent += "\n‚èπÔ∏è B√∫squeda detenida.";
    };

    btnSend.onclick = async () => {
      try {
        const res = await fetch("/save", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(catalog),
        });
        const text = await res.text();
        alert("‚úÖ " + text);
      } catch (err) {
        alert("‚ùå Error al guardar en el servidor.");
      }
    };

    function generateDummySolution(n) {
      const move = (x, y) => `(${x}, ${y})`;
      return {
        nombre: `(${n % 5}, ${n % 5}) ‚Üí (${(n + 1) % 5}, ${(n + 2) % 5}) ‚Üí (${(n + 3) % 5}, ${(n + 4) % 5}) #${Math.floor(n / 5)}`,
        recorrido: Array.from({ length: 25 }, (_, i) => move(i % 5, Math.floor(i / 5)))
      };
    }

    async function startSearching() {
      let counter = 0;
      while (running) {
        const solution = generateDummySolution(counter);
        catalog.push(solution);
        if (counter % 50 === 0) {
          progressInfo.textContent = `üîé Encontradas: ${catalog.length} soluciones...`;
          await new Promise(r => setTimeout(r, 50)); // Evita bloquear UI
        }
        counter++;
      }
    }
  </script>
</body>
</html>
